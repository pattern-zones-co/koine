name: Claude Issue Triage

on:
  issues:
    types: [opened]

jobs:
  triage-issue:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: read
      issues: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Claude Code for Issue Triage
        uses: anthropics/claude-code-action@v1
        with:
          prompt: |
            Triage the following GitHub issue by analyzing its content and applying appropriate labels.

            REPO: ${{ github.repository }}
            ISSUE_NUMBER: ${{ github.event.issue.number }}

            Steps:
            1. First, get the list of available labels by running:
               `gh label list --json name,description`
            2. Use `gh issue view ${{ github.event.issue.number }} --json title,body,labels,comments` to read the issue
            3. Analyze the issue title and body to determine:
               - Type of issue (bug, enhancement, documentation, question)
               - Priority level based on impact and urgency
               - Whether it's suitable for new contributors
            4. Apply appropriate labels (only use labels that exist in the repository) using:
               `gh issue edit ${{ github.event.issue.number }} --add-label "label1,label2"`
            5. If the issue is unclear or missing information, apply the "needs:clarification" label (do NOT leave a comment)

          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          claude_args: '--allowedTools "Bash(gh issue view:*),Bash(gh issue edit:*),Bash(gh label list:*)"'
